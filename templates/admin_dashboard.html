{% extends "base.html" %}

{% block title %}لوحة التحكم{% endblock %}
{% block page_title %}لوحة تحكم المسؤول{% endblock %}

{% block content %}
<!-- إحصائيات سريعة -->
<div class="row">
    <div class="col-md-3 mb-4">
        <div class="card card-dashboard bg-primary text-white">
            <div class="card-body text-center">
                <h5 class="card-title"><i class="bi bi-building fs-1"></i></h5>
                <h6 class="card-subtitle mb-2">الجامعات</h6>
                <h3>{{ universities|length }}</h3>
                <a href="{{ url_for('manage_university') }}" class="text-white">إضافة جديد</a>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-4">
        <div class="card card-dashboard bg-success text-white">
            <div class="card-body text-center">
                <h5 class="card-title"><i class="bi bi-journal-bookmark fs-1"></i></h5>
                <h6 class="card-subtitle mb-2">المواد</h6>
                <h3>{{ subjects|length }}</h3>
                <a href="{{ url_for('manage_subject') }}" class="text-white">إضافة جديد</a>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-4">
        <div class="card card-dashboard bg-info text-white">
            <div class="card-body text-center">
                <h5 class="card-title"><i class="bi bi-play-btn fs-1"></i></h5>
                <h6 class="card-subtitle mb-2">الدروس</h6>
                <h3>{{ lessons|length }}</h3>
                <a href="{{ url_for('manage_lesson') }}" class="text-white">إضافة جديد</a>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-4">
        <div class="card card-dashboard bg-warning text-dark">
            <div class="card-body text-center">
                <h5 class="card-title"><i class="bi bi-people fs-1"></i></h5>
                <h6 class="card-subtitle mb-2">الطلاب</h6>
                <h3>{{ users|length }}</h3>
                <a href="{{ url_for('manage_permission') }}" class="text-dark">إضافة جديد</a>
            </div>
        </div>
    </div>
</div>

<!-- جدول الجامعات -->
<div class="card mt-4">
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
        <h5 class="mb-0">جميع الجامعات</h5>
        <a href="{{ url_for('manage_university') }}" class="btn btn-light btn-sm">
            <i class="bi bi-plus-circle"></i> إضافة جامعة
        </a>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>اسم الجامعة</th>
                        <th>رابط الواتساب</th>
                        <th>عدد المواد</th>
                        <th>عدد الطلاب</th>
                        <th>الإجراءات</th>
                    </tr>
                </thead>
                <tbody>
                    {% for university in universities %}
                    <tr>
                        <td>{{ university.id }}</td>
                        <td>{{ university.name }}</td>
                        <td>
                            {% if university.whatsapp_group %}
                            <a href="{{ university.whatsapp_group }}" target="_blank" class="btn btn-success btn-sm">
                                <i class="bi bi-whatsapp"></i> رابط المجموعة
                            </a>
                            {% else %}
                            <span class="text-muted">غير متوفر</span>
                            {% endif %}
                        </td>
                        <td>{{ university.subjects|length }}</td>
                        <td>{{ university.users|length }}</td>
                        <td>
                            <a href="{{ url_for('manage_university', university_id=university.id) }}" 
                               class="btn btn-primary btn-sm">
                                <i class="bi bi-pencil"></i> تعديل
                            </a>
                            <a href="{{ url_for('delete_university', university_id=university.id) }}" 
                               class="btn btn-danger btn-sm" 
                               onclick="return confirm('هل أنت متأكد من حذف هذه الجامعة؟')">
                                <i class="bi bi-trash"></i> حذف
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- جدول المواد -->
<div class="card mt-4">
    <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
        <h5 class="mb-0">جميع المواد</h5>
        <a href="{{ url_for('manage_subject') }}" class="btn btn-light btn-sm">
            <i class="bi bi-plus-circle"></i> إضافة مادة
        </a>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>اسم المادة</th>
                        <th>الجامعة</th>
                        <th>رابط المناقشة</th>
                        <th>عدد الدروس</th>
                        <th>الإجراءات</th>
                    </tr>
                </thead>
                <tbody>
                    {% for subject in subjects %}
                    <tr>
                        <td>{{ subject.id }}</td>
                        <td>{{ subject.name }}</td>
                        <td>{{ subject.university.name }}</td>
                        <td>
                            {% if subject.discussion_group %}
                            <a href="{{ subject.discussion_group }}" target="_blank" class="btn btn-success btn-sm">
                                <i class="bi bi-whatsapp"></i> رابط المناقشة
                            </a>
                            {% else %}
                            <span class="text-muted">غير متوفر</span>
                            {% endif %}
                        </td>
                        <td>{{ subject.lessons|length }}</td>
                        <td>
                            <a href="{{ url_for('manage_subject', subject_id=subject.id) }}" 
                               class="btn btn-primary btn-sm">
                                <i class="bi bi-pencil"></i> تعديل
                            </a>
                            <a href="{{ url_for('delete_subject', subject_id=subject.id) }}" 
                               class="btn btn-danger btn-sm" 
                               onclick="return confirm('هل أنت متأكد من حذف هذه المادة؟')">
                                <i class="bi bi-trash"></i> حذف
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- جدول المستخدمين -->
<div class="card mt-4">
    <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center">
        <h5 class="mb-0">جميع المستخدمين</h5>
        <a href="{{ url_for('manage_user') }}" class="btn btn-dark btn-sm">
            <i class="bi bi-plus-circle"></i> إضافة مستخدم
        </a>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>الاسم</th>
                        <th>البريد الإلكتروني</th>
                        <th>رقم الواتساب</th>
                        <th>الجامعة</th>
                        <th>عدد الصلاحيات</th>
                        <th>الإجراءات</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr>
                        <td>{{ user.id }}</td>
                        <td>{{ user.name }}</td>
                        <td>{{ user.email }}</td>
                        <td>{{ user.whatsapp_number or 'غير متوفر' }}</td>
                        <td>{{ user.university.name if user.university else 'غير محدد' }}</td>
                        <td>{{ user.permissions|length }}</td>
                        <td>
                            <a href="{{ url_for('manage_user', user_id=user.id) }}" 
                               class="btn btn-primary btn-sm">
                                <i class="bi bi-pencil"></i> تعديل
                            </a>
                            {% if not user.is_admin %}
                            <a href="{{ url_for('delete_user', user_id=user.id) }}" 
                               class="btn btn-danger btn-sm" 
                               onclick="return confirm('هل أنت متأكد من حذف هذا المستخدم؟')">
                                <i class="bi bi-trash"></i> حذف
                            </a>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- جدول الدروس -->
<div class="card mt-4">
    <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
        <h5 class="mb-0">جميع الدروس</h5>
        <a href="{{ url_for('manage_lesson') }}" class="btn btn-light btn-sm">
            <i class="bi bi-plus-circle"></i> إضافة درس
        </a>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>عنوان الدرس</th>
                        <th>المادة</th>
                        <th>الجامعة</th>
                        <th>مسار الفيديو</th>
                        <th>الإجراءات</th>
                    </tr>
                </thead>
                <tbody>
                    {% for lesson in lessons %}
                    <tr>
                        <td>{{ lesson.id }}</td>
                        <td>{{ lesson.title }}</td>
                        <td>{{ lesson.subject.name }}</td>
                        <td>{{ lesson.subject.university.name }}</td>
                        <td>
                            {% if lesson.video_path %}
                            <a href="{{ url_for('uploaded_file', filename=lesson.video_path) }}" 
                               target="_blank" class="btn btn-success btn-sm">
                                <i class="bi bi-play-circle"></i> مشاهدة
                            </a>
                            {% else %}
                            <span class="text-muted">غير متوفر</span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="{{ url_for('manage_lesson', lesson_id=lesson.id) }}" 
                               class="btn btn-primary btn-sm">
                                <i class="bi bi-pencil"></i> تعديل
                            </a>
                            <a href="{{ url_for('delete_lesson', lesson_id=lesson.id) }}" 
                               class="btn btn-danger btn-sm" 
                               onclick="return confirm('هل أنت متأكد من حذف هذا الدرس؟')">
                                <i class="bi bi-trash"></i> حذف
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<style>
.card-dashboard {
    transition: transform 0.3s ease;
}
.card-dashboard:hover {
    transform: translateY(-5px);
}
.table th {
    border-top: none;
    font-weight: 600;
}
</style>
{% endblock %}
